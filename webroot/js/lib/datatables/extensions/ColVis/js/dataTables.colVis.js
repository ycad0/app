/*! ColVis 1.1.2
 * Â©2010-2015 SpryMedia Ltd - datatables.net/license
 */

/**
 * @summary     ColVis
 * @description Controls for column visibility in DataTables
 * @version     1.1.2
 * @file        dataTables.colReorder.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2010-2015 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */

(function(e,t,n){var r=function(e,r){"use strict";var i=function(t,n){(!this.CLASS||this.CLASS!="ColVis")&&alert("Warning: ColVis must be initialised with the keyword 'new'"),typeof n=="undefined"&&(n={});var r=e.fn.dataTable.camelToHungarian;return r&&(r(i.defaults,i.defaults,!0),r(i.defaults,n)),this.s={dt:null,oInit:n,hidden:!0,abOriginal:[]},this.dom={wrapper:null,button:null,collection:null,background:null,catcher:null,buttons:[],groupButtons:[],restore:null},i.aInstances.push(this),this.s.dt=e.fn.dataTable.Api?(new e.fn.dataTable.Api(t)).settings()[0]:t,this._fnConstruct(n),this};return i.prototype={button:function(){return this.dom.wrapper},fnRebuild:function(){this.rebuild()},rebuild:function(){for(var e=this.dom.buttons.length-1;e>=0;e--)this.dom.collection.removeChild(this.dom.buttons[e]);this.dom.buttons.splice(0,this.dom.buttons.length),this.dom.groupButtons.splice(0,this.dom.groupButtons.length),this.dom.restore&&this.dom.restore.parentNode(this.dom.restore),this._fnAddGroups(),this._fnAddButtons(),this._fnDrawCallback()},_fnConstruct:function(n){this._fnApplyCustomisation(n);var r=this,i,s;this.dom.wrapper=t.createElement("div"),this.dom.wrapper.className="ColVis",this.dom.button=e("<button />",{"class":this.s.dt.bJUI?"ColVis_Button ColVis_MasterButton ui-button ui-state-default":"ColVis_Button ColVis_MasterButton"}).append("<span>"+this.s.buttonText+"</span>").bind(this.s.activate=="mouseover"?"mouseover":"click",function(e){e.preventDefault(),r._fnCollectionShow()}).appendTo(this.dom.wrapper)[0],this.dom.catcher=this._fnDomCatcher(),this.dom.collection=this._fnDomCollection(),this.dom.background=this._fnDomBackground(),this._fnAddGroups(),this._fnAddButtons();for(i=0,s=this.s.dt.aoColumns.length;i<s;i++)this.s.abOriginal.push(this.s.dt.aoColumns[i].bVisible);this.s.dt.aoDrawCallback.push({fn:function(){r._fnDrawCallback.call(r)},sName:"ColVis"}),e(this.s.dt.oInstance).bind("column-reorder.dt",function(e,t,n){for(i=0,s=r.s.aiExclude.length;i<s;i++)r.s.aiExclude[i]=n.aiInvertMapping[r.s.aiExclude[i]];var o=r.s.abOriginal.splice(n.iFrom,1)[0];r.s.abOriginal.splice(n.iTo,0,o),r.fnRebuild()}),e(this.s.dt.oInstance).bind("destroy.dt",function(){e(r.dom.wrapper).remove()}),this._fnDrawCallback()},_fnApplyCustomisation:function(t){e.extend(!0,this.s,i.defaults,t),!this.s.showAll&&this.s.bShowAll&&(this.s.showAll=this.s.sShowAll),!this.s.restore&&this.s.bRestore&&(this.s.restore=this.s.sRestore);var n=this.s.groups,r=this.s.aoGroups;if(n)for(var s=0,o=n.length;s<o;s++)n[s].title&&(r[s].sTitle=n[s].title),n[s].columns&&(r[s].aiColumns=n[s].columns)},_fnDrawCallback:function(){var t=this.s.dt.aoColumns,r=this.dom.buttons,i=this.s.aoGroups,s;for(var o=0,u=r.length;o<u;o++)s=r[o],s.__columnIdx!==n&&e("input",s).prop("checked",t[s.__columnIdx].bVisible);var a=function(e){for(var n=0,r=e.length;n<r;n++)if(t[e[n]].bVisible===!1)return!1;return!0},f=function(e){for(var n=0,r=e.length;n<r;n++)if(t[e[n]].bVisible===!0)return!1;return!0};for(var l=0,c=i.length;l<c;l++)a(i[l].aiColumns)?(e("input",this.dom.groupButtons[l]).prop("checked",!0),e("input",this.dom.groupButtons[l]).prop("indeterminate",!1)):f(i[l].aiColumns)?(e("input",this.dom.groupButtons[l]).prop("checked",!1),e("input",this.dom.groupButtons[l]).prop("indeterminate",!1)):e("input",this.dom.groupButtons[l]).prop("indeterminate",!0)},_fnAddGroups:function(){var e;if(typeof this.s.aoGroups!="undefined")for(var t=0,n=this.s.aoGroups.length;t<n;t++)e=this._fnDomGroupButton(t),this.dom.groupButtons.push(e),this.dom.buttons.push(e),this.dom.collection.appendChild(e)},_fnAddButtons:function(){var t,n=this.s.dt.aoColumns;if(e.inArray("all",this.s.aiExclude)===-1)for(var r=0,i=n.length;r<i;r++)e.inArray(r,this.s.aiExclude)===-1&&(t=this._fnDomColumnButton(r),t.__columnIdx=r,this.dom.buttons.push(t));this.s.order==="alpha"&&this.dom.buttons.sort(function(e,t){var r=n[e.__columnIdx].sTitle,i=n[t.__columnIdx].sTitle;return r===i?0:r<i?-1:1}),this.s.restore&&(t=this._fnDomRestoreButton(),t.className+=" ColVis_Restore",this.dom.buttons.push(t)),this.s.showAll&&(t=this._fnDomShowXButton(this.s.showAll,!0),t.className+=" ColVis_ShowAll",this.dom.buttons.push(t)),this.s.showNone&&(t=this._fnDomShowXButton(this.s.showNone,!1),t.className+=" ColVis_ShowNone",this.dom.buttons.push(t)),e(this.dom.collection).append(this.dom.buttons)},_fnDomRestoreButton:function(){var t=this,n=this.s.dt;return e('<li class="ColVis_Special '+(n.bJUI?"ui-button ui-state-default":"")+'">'+this.s.restore+"</li>").click(function(e){for(var n=0,r=t.s.abOriginal.length;n<r;n++)t.s.dt.oInstance.fnSetColumnVis(n,t.s.abOriginal[n],!1);t._fnAdjustOpenRows(),t.s.dt.oInstance.fnAdjustColumnSizing(!1),t.s.dt.oInstance.fnDraw(!1)})[0]},_fnDomShowXButton:function(t,n){var r=this,i=this.s.dt;return e('<li class="ColVis_Special '+(i.bJUI?"ui-button ui-state-default":"")+'">'+t+"</li>").click(function(e){for(var t=0,i=r.s.abOriginal.length;t<i;t++)r.s.aiExclude.indexOf(t)===-1&&r.s.dt.oInstance.fnSetColumnVis(t,n,!1);r._fnAdjustOpenRows(),r.s.dt.oInstance.fnAdjustColumnSizing(!1),r.s.dt.oInstance.fnDraw(!1)})[0]},_fnDomGroupButton:function(t){var n=this,r=this.s.dt,i=this.s.aoGroups[t];return e('<li class="ColVis_Special '+(r.bJUI?"ui-button ui-state-default":"")+'">'+"<label>"+'<input type="checkbox" />'+"<span>"+i.sTitle+"</span>"+"</label>"+"</li>").click(function(t){var r=!e("input",this).is(":checked");t.target.nodeName.toLowerCase()!=="li"&&(r=!r);for(var s=0;s<i.aiColumns.length;s++)n.s.dt.oInstance.fnSetColumnVis(i.aiColumns[s],r)})[0]},_fnDomColumnButton:function(t){var n=this,r=this.s.dt.aoColumns[t],i=this.s.dt,s=this.s.fnLabel===null?r.sTitle:this.s.fnLabel(t,r.sTitle,r.nTh);return e("<li "+(i.bJUI?'class="ui-button ui-state-default"':"")+">"+"<label>"+'<input type="checkbox" />'+"<span>"+s+"</span>"+"</label>"+"</li>").click(function(r){var s=!e("input",this).is(":checked");r.target.nodeName.toLowerCase()!=="li"&&(r.target.nodeName.toLowerCase()=="input"||n.s.fnStateChange===null)&&(s=!s);var o=e.fn.dataTableExt.iApiIndex;e.fn.dataTableExt.iApiIndex=n._fnDataTablesApiIndex.call(n),i.oFeatures.bServerSide?(n.s.dt.oInstance.fnSetColumnVis(t,s,!1),n.s.dt.oInstance.fnAdjustColumnSizing(!1),(i.oScroll.sX!==""||i.oScroll.sY!=="")&&n.s.dt.oInstance.oApi._fnScrollDraw(n.s.dt),n._fnDrawCallback()):n.s.dt.oInstance.fnSetColumnVis(t,s),e.fn.dataTableExt.iApiIndex=o,n.s.fnStateChange!==null&&(r.target.nodeName.toLowerCase()=="span"&&r.preventDefault(),n.s.fnStateChange.call(n,t,s))})[0]},_fnDataTablesApiIndex:function(){for(var e=0,t=this.s.dt.oInstance.length;e<t;e++)if(this.s.dt.oInstance[e]==this.s.dt.nTable)return e;return 0},_fnDomCollection:function(){return e("<ul />",{"class":this.s.dt.bJUI?"ColVis_collection ui-buttonset ui-buttonset-multi":"ColVis_collection"}).css({display:"none",opacity:0,position:this.s.bCssPosition?"":"absolute"})[0]},_fnDomCatcher:function(){var n=this,r=t.createElement("div");return r.className="ColVis_catcher",e(r).click(function(){n._fnCollectionHide.call(n,null,null)}),r},_fnDomBackground:function(){var t=this,n=e("<div></div>").addClass("ColVis_collectionBackground").css("opacity",0).click(function(){t._fnCollectionHide.call(t,null,null)});return this.s.activate=="mouseover"&&n.mouseover(function(){t.s.overcollection=!1,t._fnCollectionHide.call(t,null,null)}),n[0]},_fnCollectionShow:function(){var n=this,r,i,s,o=e(this.dom.button).offset(),u=this.dom.collection,a=this.dom.background,f=parseInt(o.left,10),l=parseInt(o.top+e(this.dom.button).outerHeight(),10);this.s.bCssPosition||(u.style.top=l+"px",u.style.left=f+"px"),e(u).css({display:"block",opacity:0}),a.style.bottom="0px",a.style.right="0px";var c=this.dom.catcher.style;c.height=e(this.dom.button).outerHeight()+"px",c.width=e(this.dom.button).outerWidth()+"px",c.top=o.top+"px",c.left=f+"px",t.body.appendChild(a),t.body.appendChild(u),t.body.appendChild(this.dom.catcher),e(u).animate({opacity:1},n.s.iOverlayFade),e(a).animate({opacity:.1},n.s.iOverlayFade,"linear",function(){e.browser&&e.browser.msie&&e.browser.version=="6.0"&&n._fnDrawCallback()});if(!this.s.bCssPosition){s=this.s.sAlign=="left"?f:f-e(u).outerWidth()+e(this.dom.button).outerWidth(),u.style.left=s+"px";var h=e(u).outerWidth(),p=e(u).outerHeight(),d=e(t).width();s+h>d&&(u.style.left=d-h+"px")}this.s.hidden=!1},_fnCollectionHide:function(){var n=this;!this.s.hidden&&this.dom.collection!==null&&(this.s.hidden=!0,e(this.dom.collection).animate({opacity:0},n.s.iOverlayFade,function(e){this.style.display="none"}),e(this.dom.background).animate({opacity:0},n.s.iOverlayFade,function(e){t.body.removeChild(n.dom.background),t.body.removeChild(n.dom.catcher)}))},_fnAdjustOpenRows:function(){var e=this.s.dt.aoOpenRows,t=this.s.dt.oApi._fnVisbleColumns(this.s.dt);for(var n=0,r=e.length;n<r;n++)e[n].nTr.getElementsByTagName("td")[0].colSpan=t}},i.fnRebuild=function(t){var n=null;typeof t!="undefined"&&(n=e.fn.dataTable.Api?(new e.fn.dataTable.Api(t)).table().node():t.fnSettings().nTable);for(var r=0,s=i.aInstances.length;r<s;r++)(typeof t=="undefined"||n==i.aInstances[r].s.dt.nTable)&&i.aInstances[r].fnRebuild()},i.defaults={active:"click",buttonText:"Show / hide columns",aiExclude:[],bRestore:!1,sRestore:"Restore original",bShowAll:!1,sShowAll:"Show All",sAlign:"left",fnStateChange:null,iOverlayFade:500,fnLabel:null,bCssPosition:!1,aoGroups:[],order:"column"},i.aInstances=[],i.prototype.CLASS="ColVis",i.VERSION="1.1.2",i.prototype.VERSION=i.VERSION,typeof e.fn.dataTable=="function"&&typeof e.fn.dataTableExt.fnVersionCheck=="function"&&e.fn.dataTableExt.fnVersionCheck("1.7.0")?e.fn.dataTableExt.aoFeatures.push({fnInit:function(e){var t=e.oInit,n=new i(e,t.colVis||t.oColVis||{});return n.button()},cFeature:"C",sFeature:"ColVis"}):alert("Warning: ColVis requires DataTables 1.7 or greater - www.datatables.net/download"),e.fn.dataTable.ColVis=i,e.fn.DataTable.ColVis=i,i};typeof define=="function"&&define.amd?define(["jquery","datatables"],r):typeof exports=="object"?r(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.ColVis&&r(jQuery,jQuery.fn.dataTable)})(window,document);