/*! KeyTable 1.2.1
 * Â©2010-2014 SpryMedia Ltd - datatables.net/license
 */

/**
 * @summary     KeyTable
 * @description Spreadsheet like keyboard navigation for DataTables
 * @version     1.2.1
 * @file        dataTables.keyTable.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2009-2014 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */

var KeyTable;(function(e,t,n){var r=function(r,i){"use strict";return KeyTable=function(i){function g(e){return function(t,n,r){if(t!==null&&typeof t!="number"||n!==null&&typeof n!="number"||typeof r!="function")if(typeof t=="object"&&typeof n=="function"){var i=M(t);w(e,i[0],i[1],n)}else alert("Unhandable event type was added: x"+t+"  y:"+n+"  z:"+r);else w(e,t,n,r)}}function y(e){return function(t,n,r){if(t!==null&&typeof arguments[0]!="number"||n!==null&&typeof arguments[1]!="number")if(typeof arguments[0]=="object"){var i=M(t);typeof arguments[1]=="function"?E(e,i[0],i[1],n):E(e,i[0],i[1])}else alert("Unhandable event type was removed: x"+t+"  y:"+n+"  z:"+r);else typeof arguments[2]=="function"?E(e,t,n,r):E(e,t,n)}}function w(e,t,n,r){h[e].push({x:t,y:n,fn:r})}function E(e,t,n,r){var i=0;for(var s=0,o=h[e].length;s<o-i;s++)if(typeof r!="undefined")h[e][s-i].x==t&&h[e][s-i].y==n&&h[e][s-i].fn==r&&(h[e].splice(s-i,1),i++);else if(h[e][s-i].x==t&&h[e][s-i].y==n)return h[e].splice(s,1),1;return i}function S(e,t,n){var r=0,i=h[e];for(var s=0;s<i.length;s++)if(i[s].x==t&&i[s].y==n||i[s].x===null&&i[s].y==n||i[s].x==t&&i[s].y===null||i[s].x===null&&i[s].y===null)i[s].fn(O(t,n),t,n),r++;return r}function x(n,i){if(o==n)return;typeof i=="undefined"&&(i=!0),o!==null&&N(o),r(n).addClass(l),r(n).parent().addClass(l);var s;if(p){s=p;var f=H(n)[1],h=c;while(f>=s.fnDisplayEnd())s._iDisplayLength>=0?s._iDisplayStart+s._iDisplayLength<s.fnRecordsDisplay()&&(s._iDisplayStart+=s._iDisplayLength):s._iDisplayStart=0,p.oApi._fnCalculateEnd(s);while(f<s._iDisplayStart)s._iDisplayStart=s._iDisplayLength>=0?s._iDisplayStart-s._iDisplayLength:0,s._iDisplayStart<0&&(s._iDisplayStart=0),p.oApi._fnCalculateEnd(s);p.oApi._fnDraw(s),c=h}var d=M(n);o=n,u=d[0],a=d[1];var v,m,g,y,b,w,E;i&&(v=r(e).height(),m=r(e).width(),g=r(t).scrollTop(),y=r(t).scrollLeft(),b=n.offsetHeight,w=n.offsetWidth,E=P(n),p&&typeof s.oScroll!="undefined"&&(s.oScroll.sX!==""||s.oScroll.sY!=="")&&(E[1]-=r(s.nTable.parentNode).scrollTop(),E[0]-=r(s.nTable.parentNode).scrollLeft()),E[1]+b>g+v?_(E[1]+b-v):E[1]<g&&_(E[1]),E[0]+w>y+m?D(E[0]+w-m):E[0]<y&&D(E[0]));if(p&&typeof s.oScroll!="undefined"&&(s.oScroll.sX!==""||s.oScroll.sY!=="")){var x=s.nTable.parentNode;v=x.clientHeight,m=x.clientWidth,g=x.scrollTop,y=x.scrollLeft,b=n.offsetHeight,w=n.offsetWidth,n.offsetTop+b>v+g?x.scrollTop=n.offsetTop+b-v:n.offsetTop<g&&(x.scrollTop=n.offsetTop),n.offsetLeft+w>m+y?x.scrollLeft=n.offsetLeft+w-m:n.offsetLeft<y&&(x.scrollLeft=n.offsetLeft)}L(),S("focus",u,a)}function T(){N(o),u=null,a=null,o=null,A()}function N(e){r(e).removeClass(l),r(e).parent().removeClass(l),S("blur",u,a)}function C(e){var t=this;while(t.nodeName!="TD")t=t.parentNode;x(t),L()}function k(e){if(f.block||!c)return!0;if(e.metaKey||e.altKey||e.ctrlKey)return!0;var t,n,r=s.getElementsByTagName("tr")[0].getElementsByTagName("td").length,i;if(p){i=p.aiDisplay.length;var l=H(o);if(l===null)return;u=l[0],a=l[1]}else i=s.getElementsByTagName("tr").length;var h=e.keyCode==9&&e.shiftKey?-1:e.keyCode;switch(h){case 13:return e.preventDefault(),e.stopPropagation(),S("action",u,a),!0;case 27:if(!S("esc",u,a)){T();return}t=u,n=a;break;case-1:case 37:if(u>0)t=u-1,n=a;else{if(!(a>0))return h==-1&&d?(m=!0,v.focus(),setTimeout(function(){m=!1},0),c=!1,T(),!0):!1;t=r-1,n=a-1}break;case 38:if(!(a>0))return!1;t=u,n=a-1;break;case 36:t=u,n=0;break;case 33:t=u,n=a-10,n<0&&(n=0);break;case 9:case 39:if(u<r-1)t=u+1,n=a;else{if(!(a<i-1))return h==9&&d?(m=!0,v.focus(),setTimeout(function(){m=!1},0),c=!1,T(),!0):!1;t=0,n=a+1}break;case 40:if(!(a<i-1))return!1;t=u,n=a+1;break;case 35:t=u,n=i-1;break;case 34:t=u,n=a+10,n>i-1&&(n=i-1);break;default:return!0}return x(O(t,n)),!1}function L(){c||(c=!0)}function A(){c=!1}function O(e,t){return p?typeof p.aoData[p.aiDisplay[t]]!="undefined"?p.aoData[p.aiDisplay[t]].nTr.getElementsByTagName("td")[e]:null:r("tr:eq("+t+")>td:eq("+e+")",s)[0]}function M(e){return p?[r("td",e.parentNode).index(e),r("tr",e.parentNode.parentNode).index(e.parentNode)+p._iDisplayStart]:[r("td",e.parentNode).index(e),r("tr",e.parentNode.parentNode).index(e.parentNode)]}function _(e){t.documentElement.scrollTop=e,t.body.scrollTop=e}function D(e){t.documentElement.scrollLeft=e,t.body.scrollLeft=e}function P(e){var t=0,n=0;if(e.offsetParent){t=e.offsetLeft,n=e.offsetTop,e=e.offsetParent;while(e)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent}return[t,n]}function H(e){for(var t=0,n=p.aiDisplay.length;t<n;t++){var r=p.aoData[p.aiDisplay[t]].nTr,i=r.getElementsByTagName("td");for(var s=0,o=i.length;s<o;s++)if(i[s]==e)return[s,t]}return null}function B(e,n,i,o){f=o,typeof i=="undefined"&&(i={}),typeof i.focus=="undefined"&&(i.focus=[0,0]),i.table=e,r(i.table).addClass("KeyTable"),typeof i.focusClass!="undefined"&&(l=i.focusClass),typeof n!="undefined"&&(p=n),typeof i.initScroll=="undefined"&&(i.initScroll=!0),typeof i.form=="undefined"&&(i.form=!1),d=i.form,s=i.table.getElementsByTagName("tbody")[0];if(d){var u=t.createElement("div");v=t.createElement("input"),u.style.height="1px",u.style.width="0px",u.style.overflow="hidden",typeof i.tabIndex!="undefined"&&(v.tabIndex=i.tabIndex),u.appendChild(v),i.table.parentNode.insertBefore(u,i.table.nextSibling),r(v).focus(function(){m||(c=!0,m=!1,typeof i.focus.nodeName!="undefined"?x(i.focus,i.initScroll):x(O(i.focus[0],i.focus[1]),i.initScroll),setTimeout(function(){v.blur()},0))}),c=!1}else typeof i.focus.nodeName!="undefined"?x(i.focus,i.initScroll):x(O(i.focus[0],i.focus[1]),i.initScroll),L();r(t).bind("keydown",k),p?r(p.nTable).on("click","td",C):r(s).on("click","td",C),r(t).click(function(e){var t=e.target,n=!1;while(t){if(t==i.table){n=!0;break}t=t.parentNode}n||T()})}this.block=!1,this.event={remove:{}},this.fnGetCurrentPosition=function(){return[u,a]},this.fnGetCurrentData=function(){return o.innerHTML},this.fnGetCurrentTD=function(){return o},this.fnSetPosition=function(e,t){typeof e=="object"&&e.nodeName?x(e):x(O(e,t))},this.fnBlur=function(){T()};var s=null,o=null,u=null,a=null,f=null,l="focus",c=!1,h={action:[],esc:[],focus:[],blur:[]},p=null,d,v,m=!1;for(var b in h)b&&(this.event[b]=g(b),this.event.remove[b]=y(b));var j,F;i===n?(j=r("table.KeyTable")[0],F=null):r.isPlainObject(i)?(j=i.table,F=i.datatable):(F=(new r.fn.dataTable.Api(i)).settings()[0],j=F.nTable),B(j,F,i,this)},KeyTable.version="1.2.1",r.fn.dataTable.KeyTable=KeyTable,r.fn.DataTable.KeyTable=KeyTable,KeyTable};typeof define=="function"&&define.amd?define(["jquery","datatables"],r):typeof exports=="object"?r(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.KeyTable&&r(jQuery,jQuery.fn.dataTable)})(window,document);