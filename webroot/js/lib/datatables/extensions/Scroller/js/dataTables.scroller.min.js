/*!
 Scroller 1.2.2
 Â©2011-2014 SpryMedia Ltd - datatables.net/license
*/

(function(e,t,n){var r=function(r){var i=function(e,n){!this instanceof i?alert("Scroller warning: Scroller must be initialised with the 'new' keyword."):("undefined"==typeof n&&(n={}),this.s={dt:e,tableTop:0,tableBottom:0,redrawTop:0,redrawBottom:0,autoHeight:!0,viewportRows:0,stateTO:null,drawTO:null,heights:{jump:null,page:null,virtual:null,scroll:null,row:null,viewport:null},topRowFloat:0,scrollDrawDiff:null,loaderVisible:!1},this.s=r.extend(this.s,i.oDefaults,n),this.s.heights.row=this.s.rowHeight,this.dom={force:t.createElement("div"),scroller:null,table:null,loader:null},this.s.dt.oScroller=this,this._fnConstruct())};i.prototype={fnRowToPixels:function(e,t,r){return e=r?this._domain("virtualToPhysical",e*this.s.heights.row):this.s.baseScrollTop+(e-this.s.baseRowTop)*this.s.heights.row,t||t===n?parseInt(e,10):e},fnPixelsToRow:function(e,t,r){var i=e-this.s.baseScrollTop,e=r?this._domain("physicalToVirtual",e)/this.s.heights.row:i/this.s.heights.row+this.s.baseRowTop;return t||t===n?parseInt(e,10):e},fnScrollToRow:function(e,t){var n=this,i=!1,s=this.fnRowToPixels(e),o=e-(this.s.displayBuffer-1)/2*this.s.viewportRows;0>o&&(o=0),(s>this.s.redrawBottom||s<this.s.redrawTop)&&this.s.dt._iDisplayStart!==o&&(i=!0,s=this.fnRowToPixels(e,!1,!0)),"undefined"==typeof t||t?(this.s.ani=i,r(this.dom.scroller).animate({scrollTop:s},function(){setTimeout(function(){n.s.ani=!1},25)})):r(this.dom.scroller).scrollTop(s)},fnMeasure:function(e){this.s.autoHeight&&this._fnCalcRowHeight();var t=this.s.heights;t.viewport=r(this.dom.scroller).height(),this.s.viewportRows=parseInt(t.viewport/t.row,10)+1,this.s.dt._iDisplayLength=this.s.viewportRows*this.s.displayBuffer,(e===n||e)&&this.s.dt.oInstance.fnDraw()},_fnConstruct:function(){var t=this;if(this.s.dt.oFeatures.bPaginate){this.dom.force.style.position="absolute",this.dom.force.style.top="0px",this.dom.force.style.left="0px",this.dom.force.style.width="1px",this.dom.scroller=r("div."+this.s.dt.oClasses.sScrollBody,this.s.dt.nTableWrapper)[0],this.dom.scroller.appendChild(this.dom.force),this.dom.scroller.style.position="relative",this.dom.table=r(">table",this.dom.scroller)[0],this.dom.table.style.position="absolute",this.dom.table.style.top="0px",this.dom.table.style.left="0px",r(this.s.dt.nTableWrapper).addClass("DTS"),this.s.loadingIndicator&&(this.dom.loader=r('<div class="DTS_Loading">'+this.s.dt.oLanguage.sLoadingRecords+"</div>").css("display","none"),r(this.dom.scroller.parentNode).css("position","relative").append(this.dom.loader)),this.s.heights.row&&"auto"!=this.s.heights.row&&(this.s.autoHeight=!1),this.fnMeasure(!1),this.s.ingnoreScroll=!0,this.s.stateSaveThrottle=this.s.dt.oApi._fnThrottle(function(){t.s.dt.oApi._fnSaveState(t.s.dt)},500),r(this.dom.scroller).on("scroll.DTS",function(){t._fnScroll.call(t)}),r(this.dom.scroller).on("touchstart.DTS",function(){t._fnScroll.call(t)}),this.s.dt.aoDrawCallback.push({fn:function(){t.s.dt.bInitialised&&t._fnDrawCallback.call(t)},sName:"Scroller"}),r(e).on("resize.DTS",function(){t.fnMeasure(!1),t._fnInfo()});var n=!0;this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(e,r){n&&t.s.dt.oLoadedState?(r.iScroller=t.s.dt.oLoadedState.iScroller,r.iScrollerTopRow=t.s.dt.oLoadedState.iScrollerTopRow,n=!1):(r.iScroller=t.dom.scroller.scrollTop,r.iScrollerTopRow=t.s.topRowFloat)},"Scroller_State"),this.s.dt.oLoadedState&&(this.s.topRowFloat=this.s.dt.oLoadedState.iScrollerTopRow||0),this.s.dt.aoDestroyCallback.push({sName:"Scroller",fn:function(){r(e).off("resize.DTS"),r(t.dom.scroller).off("touchstart.DTS scroll.DTS"),r(t.s.dt.nTableWrapper).removeClass("DTS"),r("div.DTS_Loading",t.dom.scroller.parentNode).remove(),t.dom.table.style.position="",t.dom.table.style.top="",t.dom.table.style.left=""}})}else this.s.dt.oApi._fnLog(this.s.dt,0,"Pagination must be enabled for Scroller")},_fnScroll:function(){var e=this,t=this.s.heights,n=this.dom.scroller.scrollTop,i;if(!this.s.skip&&!this.s.ingnoreScroll)if(this.s.dt.bFiltered||this.s.dt.bSorted)this.s.lastScrollTop=0;else{this._fnInfo(),clearTimeout(this.s.stateTO),this.s.stateTO=setTimeout(function(){e.s.dt.oApi._fnSaveState(e.s.dt)},250);if(n<this.s.redrawTop||n>this.s.redrawBottom){var s=Math.ceil((this.s.displayBuffer-1)/2*this.s.viewportRows);Math.abs(n-this.s.lastScrollTop)>t.viewport||this.s.ani?(i=parseInt(this._domain("physicalToVirtual",n)/t.row,10)-s,this.s.topRowFloat=this._domain("physicalToVirtual",n)/t.row):(i=this.fnPixelsToRow(n)-s,this.s.topRowFloat=this.fnPixelsToRow(n,!1)),0>=i?i=0:i+this.s.dt._iDisplayLength>this.s.dt.fnRecordsDisplay()?(i=this.s.dt.fnRecordsDisplay()-this.s.dt._iDisplayLength,0>i&&(i=0)):0!==i%2&&i++,i!=this.s.dt._iDisplayStart&&(this.s.tableTop=r(this.s.dt.nTable).offset().top,this.s.tableBottom=r(this.s.dt.nTable).height()+this.s.tableTop,t=function(){e.s.scrollDrawReq===null&&(e.s.scrollDrawReq=n),e.s.dt._iDisplayStart=i,e.s.dt.oApi._fnCalculateEnd&&e.s.dt.oApi._fnCalculateEnd(e.s.dt),e.s.dt.oApi._fnDraw(e.s.dt)},this.s.dt.oFeatures.bServerSide?(clearTimeout(this.s.drawTO),this.s.drawTO=setTimeout(t,this.s.serverWait)):t(),this.dom.loader&&!this.s.loaderVisible)&&(this.dom.loader.css("display","block"),this.s.loaderVisible=!0)}this.s.lastScrollTop=n,this.s.stateSaveThrottle()}},_domain:function(e,t){var n=this.s.heights,r;if(n.virtual===n.scroll){r=(n.virtual-n.viewport)/(n.scroll-n.viewport);if("virtualToPhysical"===e)return t/r;if("physicalToVirtual"===e)return t*r}var i=(n.scroll-n.viewport)/2,s=(n.virtual-n.viewport)/2;r=s/(i*i);if("virtualToPhysical"===e)return t<s?Math.pow(t/r,.5):(t=2*s-t,0>t?n.scroll:2*i-Math.pow(t/r,.5));if("physicalToVirtual"===e)return t<i?t*t*r:(t=2*i-t,0>t?n.virtual:2*s-t*t*r)},_fnDrawCallback:function(){var e=this,t=this.s.heights,n=this.dom.scroller.scrollTop,i=r(this.s.dt.nTable).height(),s=this.s.dt._iDisplayStart,o=this.s.dt._iDisplayLength,u=this.s.dt.fnRecordsDisplay();this.s.skip=!0,this._fnScrollForce(),n=0===s?this.s.topRowFloat*t.row:s+o>=u?t.scroll-(u-this.s.topRowFloat)*t.row:this._domain("virtualToPhysical",this.s.topRowFloat*t.row),this.dom.scroller.scrollTop=n,this.s.baseScrollTop=n,this.s.baseRowTop=this.s.topRowFloat;var a=n-(this.s.topRowFloat-s)*t.row;0===s?a=0:s+o>=u&&(a=t.scroll-i),this.dom.table.style.top=a+"px",this.s.tableTop=a,this.s.tableBottom=i+this.s.tableTop,i=(n-this.s.tableTop)*this.s.boundaryScale,this.s.redrawTop=n-i,this.s.redrawBottom=n+i,this.s.skip=!1,this.s.dt.oFeatures.bStateSave&&null!==this.s.dt.oLoadedState&&"undefined"!=typeof this.s.dt.oLoadedState.iScroller?((n=(this.s.dt.sAjaxSource||e.s.dt.ajax)&&!this.s.dt.oFeatures.bServerSide?!0:!1)&&2==this.s.dt.iDraw||!n&&1==this.s.dt.iDraw)&&setTimeout(function(){r(e.dom.scroller).scrollTop(e.s.dt.oLoadedState.iScroller),e.s.redrawTop=e.s.dt.oLoadedState.iScroller-t.viewport/2,setTimeout(function(){e.s.ingnoreScroll=!1},0)},0):e.s.ingnoreScroll=!1,setTimeout(function(){e._fnInfo.call(e)},0),this.dom.loader&&this.s.loaderVisible&&(this.dom.loader.css("display","none"),this.s.loaderVisible=!1)},_fnScrollForce:function(){var e=this.s.heights;e.virtual=e.row*this.s.dt.fnRecordsDisplay(),e.scroll=e.virtual,1e6<e.scroll&&(e.scroll=1e6),this.dom.force.style.height=e.scroll+"px"},_fnCalcRowHeight:function(){var e=this.s.dt,t=e.nTable,n=t.cloneNode(!1),i=r("<tbody/>").appendTo(n),s=r('<div class="'+e.oClasses.sWrapper+' DTS"><div class="'+e.oClasses.sScrollWrapper+'"><div class="'+e.oClasses.sScrollBody+'"></div></div></div>');for(r("tbody tr:lt(4)",t).clone().appendTo(i);3>r("tr",i).length;)i.append("<tr><td>&nbsp;</td></tr>");r("div."+e.oClasses.sScrollBody,s).append(n),e._bInitComplete?e=t.parentNode:(this.s.dt.nHolding||(this.s.dt.nHolding=r("<div></div>").insertBefore(this.s.dt.nTable)),e=this.s.dt.nHolding),s.appendTo(e),this.s.heights.row=r("tr",i).eq(1).outerHeight(),s.remove()},_fnInfo:function(){if(this.s.dt.oFeatures.bInfo){var e=this.s.dt,t=e.oLanguage,n=this.dom.scroller.scrollTop,i=Math.floor(this.fnPixelsToRow(n,!1,this.s.ani)+1),s=e.fnRecordsTotal(),o=e.fnRecordsDisplay(),n=Math.ceil(this.fnPixelsToRow(n+this.s.heights.viewport,!1,this.s.ani)),n=o<n?o:n,u=e.fnFormatNumber(i),a=e.fnFormatNumber(n),f=e.fnFormatNumber(s),l=e.fnFormatNumber(o),u=0===e.fnRecordsDisplay()&&e.fnRecordsDisplay()==e.fnRecordsTotal()?t.sInfoEmpty+t.sInfoPostFix:0===e.fnRecordsDisplay()?t.sInfoEmpty+" "+t.sInfoFiltered.replace("_MAX_",f)+t.sInfoPostFix:e.fnRecordsDisplay()==e.fnRecordsTotal()?t.sInfo.replace("_START_",u).replace("_END_",a).replace("_MAX_",f).replace("_TOTAL_",l)+t.sInfoPostFix:t.sInfo.replace("_START_",u).replace("_END_",a).replace("_MAX_",f).replace("_TOTAL_",l)+" "+t.sInfoFiltered.replace("_MAX_",e.fnFormatNumber(e.fnRecordsTotal()))+t.sInfoPostFix;(t=t.fnInfoCallback)&&(u=t.call(e.oInstance,e,i,n,s,o,u)),e=e.aanFeatures.i;if("undefined"!=typeof e){i=0;for(s=e.length;i<s;i++)r(e[i]).html(u)}}}},i.defaults={trace:!1,rowHeight:"auto",serverWait:200,displayBuffer:9,boundaryScale:.5,loadingIndicator:!1},i.oDefaults=i.defaults,i.version="1.2.2","function"==typeof r.fn.dataTable&&"function"==typeof r.fn.dataTableExt.fnVersionCheck&&r.fn.dataTableExt.fnVersionCheck("1.9.0")?r.fn.dataTableExt.aoFeatures.push({fnInit:function(e){var t=e.oInit;return(new i(e,t.scroller||t.oScroller||{})).dom.wrapper},cFeature:"S",sFeature:"Scroller"}):alert("Warning: Scroller requires DataTables 1.9.0 or greater - www.datatables.net/download"),r.fn.dataTable.Scroller=i,r.fn.DataTable.Scroller=i;if(r.fn.dataTable.Api){var s=r.fn.dataTable.Api;s.register("scroller()",function(){return this}),s.register("scroller().rowToPixels()",function(e,t,n){var r=this.context;if(r.length&&r[0].oScroller)return r[0].oScroller.fnRowToPixels(e,t,n)}),s.register("scroller().pixelsToRow()",function(e,t,n){var r=this.context;if(r.length&&r[0].oScroller)return r[0].oScroller.fnPixelsToRow(e,t,n)}),s.register("scroller().scrollToRow()",function(e,t){return this.iterator("table",function(n){n.oScroller&&n.oScroller.fnScrollToRow(e,t)}),this}),s.register("scroller().measure()",function(e){return this.iterator("table",function(t){t.oScroller&&t.oScroller.fnMeasure(e)}),this})}return i};"function"==typeof define&&define.amd?define(["jquery","datatables"],r):"object"==typeof exports?r(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.Scroller&&r(jQuery,jQuery.fn.dataTable)})(window,document);