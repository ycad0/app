/*!
 AutoFill 1.2.1
 Â©2008-2014 SpryMedia Ltd - datatables.net/license
*/

(function(e,t,n){var r=function(r,i){var s=function(e,t){if(this instanceof s){if(!r.fn.dataTableExt.fnVersionCheck("1.7.0"))throw"Warning: AutoFill requires DataTables 1.7 or greater";return this.c={},this.s={filler:{height:0,width:0},border:{width:2},drag:{startX:-1,startY:-1,startTd:null,endTd:null,dragging:!1},screen:{interval:null,y:0,height:0,scrollTop:0},scroller:{top:0,bottom:0},columns:[]},this.dom={table:null,filler:null,borderTop:null,borderRight:null,borderBottom:null,borderLeft:null,currentTarget:null},this.fnSettings=function(){return this.s},this._fnInit(e,t),this}throw"Warning: AutoFill must be initialised with the keyword 'new'"};return s.prototype={_fnInit:function(e,n){var o=this;this.s.dt=i.Api?(new i.Api(e)).settings()[0]:e.fnSettings(),this.s.init=n||{},this.dom.table=this.s.dt.nTable,r.extend(!0,this.c,s.defaults,n),this._initColumns();var u=r("<div/>",{"class":"AutoFill_filler"}).appendTo("body");this.dom.filler=u[0],this.s.filler.height=u.height(),this.s.filler.width=u.width(),u[0].style.display="none";var a,f=t.body;""!==o.s.dt.oScroll.sY&&(o.s.dt.nTable.parentNode.style.position="relative",f=o.s.dt.nTable.parentNode),a=r("<div/>",{"class":"AutoFill_border"}),this.dom.borderTop=a.clone().appendTo(f)[0],this.dom.borderRight=a.clone().appendTo(f)[0],this.dom.borderBottom=a.clone().appendTo(f)[0],this.dom.borderLeft=a.clone().appendTo(f)[0],u.on("mousedown.DTAF",function(e){return this.onselectstart=function(){return!1},o._fnFillerDragStart.call(o,e),!1}),r("tbody",this.dom.table).on("mouseover.DTAF mouseout.DTAF",">tr>td, >tr>th",function(e){o._fnFillerDisplay.call(o,e)}),r(this.dom.table).on("destroy.dt.DTAF",function(){u.off("mousedown.DTAF").remove(),r("tbody",this.dom.table).off("mouseover.DTAF mouseout.DTAF")})},_initColumns:function(){var e=this,t,n,i=this.s.dt,o=this.s.init;t=0;for(n=i.aoColumns.length;t<n;t++)this.s.columns[t]=r.extend(!0,{},s.defaults.column);i.oApi._fnApplyColumnDefs(i,o.aoColumnDefs||o.columnDefs,o.aoColumns||o.columns,function(t,n){e._fnColumnOptions(t,n)}),t=0;for(n=i.aoColumns.length;t<n;t++)if(i=this.s.columns[t],i.read||(i.read=this._fnReadCell),i.write||(i.read=this._fnWriteCell),!i.step)i.read=this._fnStep},_fnColumnOptions:function(e,t){var r=this.s.columns[e],i=function(e,i){t[i[0]]!==n&&(r[e]=t[i[0]]),t[i[1]]!==n&&(r[e]=t[i[1]])};i("enable",["bEnable","enable"]),i("read",["fnRead","read"]),i("write",["fnWrite","write"]),i("step",["fnStep","step"]),i("increment",["bIncrement","increment"])},_fnTargetCoords:function(e){var t=r(e).parents("tr")[0],n=this.s.dt.oInstance.fnGetPosition(e);return{x:r("td",t).index(e),y:r("tr",t.parentNode).index(t),row:n[0],column:n[2]}},_fnUpdateBorder:function(e,t){var n=this.s.border.width,i=r(e).offset(),s=r(t).offset(),o=i.left-n,u=s.left+r(t).outerWidth(),a=i.top-n,f=s.top+r(t).outerHeight(),l=s.left+r(t).outerWidth()-i.left+2*n,h=s.top+r(t).outerHeight()-i.top+2*n;i.left>s.left&&(o=s.left-n,u=i.left+r(e).outerWidth(),l=i.left+r(e).outerWidth()-s.left+2*n),""!==this.s.dt.oScroll.sY&&(n=r(this.s.dt.nTable.parentNode).offset(),i=r(this.s.dt.nTable.parentNode).scrollTop(),s=r(this.s.dt.nTable.parentNode).scrollLeft(),o-=n.left-s,u-=n.left-s,a-=n.top-i,f-=n.top-i),n=this.dom.borderTop.style,n.top=a+"px",n.left=o+"px",n.height=this.s.border.width+"px",n.width=l+"px",n=this.dom.borderBottom.style,n.top=f+"px",n.left=o+"px",n.height=this.s.border.width+"px",n.width=l+"px",n=this.dom.borderLeft.style,n.top=a+"px",n.left=o+"px",n.height=h+"px",n.width=this.s.border.width+"px",n=this.dom.borderRight.style,n.top=a+"px",n.left=u+"px",n.height=h+"px",n.width=this.s.border.width+"px"},_fnFillerDragStart:function(n){var i=this,s=this.dom.currentTarget;this.s.drag.dragging=!0,i.dom.borderTop.style.display="block",i.dom.borderRight.style.display="block",i.dom.borderBottom.style.display="block",i.dom.borderLeft.style.display="block";var u=this._fnTargetCoords(s);this.s.drag.startX=u.x,this.s.drag.startY=u.y,this.s.drag.startTd=s,this.s.drag.endTd=s,this._fnUpdateBorder(s,s),r(t).bind("mousemove.AutoFill",function(e){i._fnFillerDragMove.call(i,e)}),r(t).bind("mouseup.AutoFill",function(e){i._fnFillerFinish.call(i,e)}),this.s.screen.y=n.pageY,this.s.screen.height=r(e).height(),this.s.screen.scrollTop=r(t).scrollTop(),""!==this.s.dt.oScroll.sY&&(this.s.scroller.top=r(this.s.dt.nTable.parentNode).offset().top,this.s.scroller.bottom=this.s.scroller.top+r(this.s.dt.nTable.parentNode).height()),this.s.screen.interval=setInterval(function(){var e=r(t).scrollTop();i.s.screen.y=i.s.screen.y+(e-i.s.screen.scrollTop),i.s.screen.height-i.s.screen.y+e<50?r("html, body").animate({scrollTop:e+50},240,"linear"):i.s.screen.y-e<50&&r("html, body").animate({scrollTop:e-50},240,"linear"),i.s.dt.oScroll.sY!==""&&(i.s.screen.y>i.s.scroller.bottom-50?r(i.s.dt.nTable.parentNode).animate({scrollTop:r(i.s.dt.nTable.parentNode).scrollTop()+50},240,"linear"):i.s.screen.y<i.s.scroller.top+50&&r(i.s.dt.nTable.parentNode).animate({scrollTop:r(i.s.dt.nTable.parentNode).scrollTop()-50},240,"linear"))},250)},_fnFillerDragMove:function(e){if(e.target&&"TD"==e.target.nodeName.toUpperCase()&&e.target!=this.s.drag.endTd){var n=this._fnTargetCoords(e.target);"y"==this.c.mode&&n.x!=this.s.drag.startX&&(e.target=r("tbody>tr:eq("+n.y+")>td:eq("+this.s.drag.startX+")",this.dom.table)[0]),"x"==this.c.mode&&n.y!=this.s.drag.startY&&(e.target=r("tbody>tr:eq("+this.s.drag.startY+")>td:eq("+n.x+")",this.dom.table)[0]),"either"==this.c.mode&&(n.x!=this.s.drag.startX?e.target=r("tbody>tr:eq("+this.s.drag.startY+")>td:eq("+n.x+")",this.dom.table)[0]:n.y!=this.s.drag.startY&&(e.target=r("tbody>tr:eq("+n.y+")>td:eq("+this.s.drag.startX+")",this.dom.table)[0])),"both"!==this.c.mode&&(n=this._fnTargetCoords(e.target));var i=this.s.drag;i.endTd=e.target,n.y>=this.s.drag.startY?this._fnUpdateBorder(i.startTd,i.endTd):this._fnUpdateBorder(i.endTd,i.startTd),this._fnFillerPosition(e.target)}this.s.screen.y=e.pageY,this.s.screen.scrollTop=r(t).scrollTop(),""!==this.s.dt.oScroll.sY&&(this.s.scroller.scrollTop=r(this.s.dt.nTable.parentNode).scrollTop(),this.s.scroller.top=r(this.s.dt.nTable.parentNode).offset().top,this.s.scroller.bottom=this.s.scroller.top+r(this.s.dt.nTable.parentNode).height())},_fnFillerFinish:function(){var e=this,n,s;r(t).unbind("mousemove.AutoFill mouseup.AutoFill"),this.dom.borderTop.style.display="none",this.dom.borderRight.style.display="none",this.dom.borderBottom.style.display="none",this.dom.borderLeft.style.display="none",this.s.drag.dragging=!1,clearInterval(this.s.screen.interval);var o=[],u=this.dom.table,a=this._fnTargetCoords(this.s.drag.startTd),f=this._fnTargetCoords(this.s.drag.endTd),l=function(t){return e.s.dt.oApi._fnVisibleToColumnIndex(e.s.dt,t)};if(a.y<=f.y)for(n=a.y;n<=f.y;n++)if(a.x<=f.x)for(s=a.x;s<=f.x;s++)o.push({node:r("tbody>tr:eq("+n+")>td:eq("+s+")",u)[0],x:s-a.x,y:n-a.y,colIdx:l(s)});else for(s=a.x;s>=f.x;s--)o.push({node:r("tbody>tr:eq("+n+")>td:eq("+s+")",u)[0],x:s-a.x,y:n-a.y,colIdx:l(s)});else for(n=a.y;n>=f.y;n--)if(a.x<=f.x)for(s=a.x;s<=f.x;s++)o.push({node:r("tbody>tr:eq("+n+")>td:eq("+s+")",u)[0],x:s-a.x,y:n-a.y,colIdx:l(s)});else for(s=a.x;s>=f.x;s--)o.push({node:r("tbody>tr:eq("+n+")>td:eq("+s+")",u)[0],x:a.x-s,y:a.y-n,colIdx:l(s)});if(!(1>=o.length)){var u=[],h;n=0;for(s=o.length;n<s;n++){var a=o[n],f=this.s.columns[a.colIdx],l=f.read.call(f,a.node),p=f.step.call(f,a.node,l,h,n,a.x,a.y);f.write.call(f,a.node,p),h=p,u.push({cell:a,colIdx:a.colIdx,newValue:p,oldValue:l})}null!==this.c.complete&&this.c.complete.call(this,u),i.Api?(new i.Api(this.s.dt)).draw(!1):this.s.dt.oInstance.fnDraw()}},_fnFillerDisplay:function(e){var t=this.dom.filler;if(!this.s.drag.dragging){var n="td"==e.target.nodeName.toLowerCase()?e.target:r(e.target).parents("td")[0],i=this._fnTargetCoords(n).column;if(this.s.columns[i].enable){if("mouseover"==e.type)this.dom.currentTarget=n,this._fnFillerPosition(n),t.style.display="block";else if(!e.relatedTarget||!e.relatedTarget.className.match(/AutoFill/))t.style.display="none"}else t.style.display="none"}},_fnFillerPosition:function(e){var t=r(e).offset(),n=this.dom.filler;n.style.top=t.top-this.s.filler.height/2-1+r(e).outerHeight()+"px",n.style.left=t.left-this.s.filler.width/2-1+r(e).outerWidth()+"px"}},i.AutoFill=s,i.AutoFill=s,s.version="1.2.1",s.defaults={mode:"y",complete:null,column:{enable:!0,increment:!0,read:function(e){return r(e).html()},write:function(e,t){var n=r(e).parents("table");if(i.Api)n.DataTable().cell(e).data(t);else{var n=n.dataTable(),s=n.fnGetPosition(e);n.fnUpdate(t,s[0],s[2],!1)}},step:function(e,t,r,i,s,o){return e=/(\-?\d+)/,(i=this.increment&&r?r.match(e):null)?r.replace(e,parseInt(i[1],10)+(0>s||0>o?-1:1)):r===n?t:r}}},s};"function"==typeof define&&define.amd?define(["jquery","datatables"],r):"object"==typeof exports?r(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.AutoFill&&r(jQuery,jQuery.fn.dataTable)})(window,document);